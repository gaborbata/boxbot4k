<!DOCTYPE html>
<html>
  <head>
    <title>BoxBot</title>
    <script type="text/javascript">
      var W = 14,
          H = 12,
          A = 'addEventListener',
          F = 'fillText',
          M = 'drawImage',
          T = 'charCodeAt',
          S = 'fillStyle',
          X = 'getContext',
          U = document,
          O = window,
          N = 'length',
          R = 'rgba(0,0,0,0)',
          Q = 'rgba(0,0,0,0.3)',
          P = [
            ['#21285c','#19204c','#303378',2],['#5c3c20','#4c3018','#785830',2],['#74060c','#640305','#8e1618',2],
            ['#a29b79','#cec491','#7f7543',3],[R,'#c0c0c0','#808080',0],['#c4a864','#a88448','#6f4e2a',1],
            ['#c47865','#a85449','#6f2c2b',1],[R,Q,Q,0],
            [Q,Q,Q,1]
          ],
          C = W * 16,
          E = ('LEVEL COMPLETED! PRESS ENTER TO CONTINUE.|BOXBOT||GAME CONTROLS:|ARROW KEYS - MOVE|BACKSPACE - RESTART LEVEL|'+
              'PGUP/PGDN - NEXT/PREVIOUS LEVEL||PRESS ANY KEY TO START.|(C) 2014 GABOR BATA|     |LEVEL: |MOVES: |PUSHES: ').split('|'),
          L = D("RlpDk*3%!N!3!$(7+ -#~  lk(1!!%$1!&\"!16.bel/4k(1!N1#&#\"1!!$!1)!1!!(2)#gl/4/4p!$(1w!1\"!!\"2+#sb. 6. #\"#%#1!!$!1"+
                "\"N2(#m/l~   -3+!3!\"&&%$3+abm/lt )2(O1\"%%\"1!O1!$!!2(#m/lf )2(O1)!1(!\"(#+o!#$\"1w!1!N1\"!(2)#f +#9E#5%J#3+!3O\""+
                "$\"#9%#i, 6.bfl.n!!)3+!3!\"\"#8+o!N2(#A/lfb. 6*b!#K)4!%j) z%m!#)y\"\"!6)o$!*3m/lgb.Bi*o$%\"m*y!&6* z%D#*bm/lrlk)#5"+
                "\"j5$%89M1D/4/lg *1O\"1!%#\"1)K9#!O1%!$!1j2*#hb. 6+l(!3\"&j3!%#m9Am, ,#slp\"$#k(1N!1!%\"!1!!(2)#vb, (658!#3!O\"!3!"+
                "\"m!3#%#\"89$!i,bf ,#9)75(#\"3#!z3mN3!!$!%#3mm, ,#e )2(O)#*C!#$\"#*Cw\"#*4H\"L*6.brb.y$i5z3#%\"&#!3!%\"&!!3!M3)!2+"+
                "#Wl/4p%$#p\"%(#9#\"%m3!\"6L#,!L*6.bUlk(1!$!!1D%##9#\"%m5%\"P569)K,om/lW ,3#m!i)y8!%m)y!\"$\"j)n8!%(#*y\"!\"!q,#~  "+
                "lk*3!!\"&\"!3N%!$3(!)#+bt ,#9\"!\"7, 6!#9#!N1w#1!!$#.btl/416#5$%85P!#9\"\"j, ,#tlp!\"2(#m#5%%m9*!#9#%P1\"$\"#.bgb."+
                " 6,o%P3!!%$%!3!E3(\"i+ +#r +1)!1!!\"%*#)n&\"%)!L#$\"%6*n!!*#+l~ * ,3F(!3!%&%#!3!#$(!3!!\"i+ +#~ ( ,3#)\"$##*y!88*y"+
                "N!8*46* .#~ )l,l!$#5!%85\"!89#\"D2*#s -3!\"$\"!!3N%!!3#&#&(3*!#9*!#5!)#,lg ,#5\"j5!%\"\"#,o%&(3!%$(!3+a -#s )2(O1)"+
                "K5F\"#5(%$#,o!#!x#!7.btb, (65(%$#9(D#9)!2+#u *1z1!$m9#!8#5%&!1!G1!72*#hlk2(#8#5!%m9$#&D3!!&\"!ao)!2+#Xb,o$m9\"!%75"+
                "!8#+o!(3Hm9*!#9\"!i,bhl/4x#$\"!x#\"\"%#1w!1)!2+#tlp!i+o!\"!!3$(%!!3j\"ao\"m2*#sl/4k)#5\"\"&!3#w$!3(!)3j.beb.Bi5!\""+
                "%i*n7N37!%$3G!85!)#,lelk*3)!A#*y\"&\"%&!#*nm%!!3#(i,bvl+b!!3(!\"\"%##*y%$#!8*n%\"\"(!3m#!a -#rb. 6.y#%##9#\"\"A5&"+
                "\"85H##9)!2+#do0 #\"*#9(\"m5Pi*Bw!$#*o!!%8, (6.bc -3m#7*n(!%m*y!%#%7* 6AL#D#!a -#sb. z1z(3!)%!3!)\"!3#!$i,br -3"+
                "\"\"!$\"\"3!!(8+l!)L#,!L#*!8*y!+#*lI |1|#- #|2|#- |3|#+ #|4| #!!#|5|, #!|6|#(!#|7|!\"#|8|%!#|9|, #|a|!#+|b| *#|i|!"+
                "(#|j|(!#|k|/ #!!|l| )#|m|!!#|n| ##|o| (#|p|/ #|q|#, |w|!%%|x|#. |y| #!|z|#(!|A|$!#|B| #(|C| #)|D|\"!#|E|#)!|F|#!\""+
                "|G|#\"!|H|#!%|J|##!|K|!##|L|#* |M|#!!(|N|!%!|O|#!!|P|#!#"),
          I = D("* *!\"/aic*!c!(\"!c*!c+\",a,i\")a,i\")a!*\"i\")a!*\"i\")b,!(\"+ -\".a a/a a- (g (!\"+ "+
                ")\"  )\"7j9\"+!\"\"08+8!!6hhhh\" 0g0g0g0g0g0g0g0g0g0g0g0!6\"4j9\"+!\"\"08+8!!6\"- -121212121212!- 5!-212121212121 "+
                "-!. .8(! (!, \"(!e!,b!8\"!,d3\" .\" 3\" (8)! 3\"(! \"(8\"3\"!8\"!3\"3\"3\"3\"\"8\"\"3\"8(\"!d3\" )\" d 3\" .! 3\"("+
                "!, \"8f!,b!d!,dd  .\" |0|!!\" !|1|! +\"|2| !+ |3|!( |8|!  |9|!!\"|a| !\"|b| \"\"|c|\"/ |d| (\"|e| \"!|f|\"\"!|g|!"+
                "\" |h|\"( |i|!\"!|j| \" " ),
          z, t, w, m, h, f, v, u, q, b;

      function D(k) {
          var i, r = 1, c, d = '', x = k.split("|"), y = x.shift();
          for (i = 0; i < x[N]; i += 2) {
              y = y.replace(RegExp(x[i],'g'), x[i + 1]);
          }
          for (x = 0; x < y[N]; x++) {
              c = y[T](x);
              if (c >= 0x27) {
                  r = c - 0x25;
              } else {
                  for (i = 0; i < r; i++) {
                      d += y.charAt(x);
                  }
                  r = 1;
              }
          }
          return d;
      }

      function g(k, x, o) {
          var i = 0;
          while (i < o[N]) {
              o[i] = k[T](x * o[N] + i) - 0x20;
              i++;
          }
      }

      function l() {
          if (v < 0) {
              v = 50 - 1;
          } else if (v > 50 - 1) {
              v = 0;
          }
          m = 0;
          h = 0;
          f = !1;
          g(L, v, t);
          for (var x = 0; x < W; x++) {
              for (var y = 0; y < H; y++) {
                  if (t[W * y + x] == 4) {
                      t[W * y + x] = 1;
                      u.x = x;
                      u.y = y;
                  }
              }
          }
      }

      function p() {
          for (var i = 0; i < 3; i++) {
              for (var x = 0; x < W; x++) {
                  for (var y = 0; y < H; y++) {
                      if (!q) {
                          w[M](z[0], x * 32, y * 32);
                      } else if (i == 0 && t[W * y + x] <= 2) {
                          w[M](z[t[W * y + x]], x * 32, y * 32);
                      } else if (i == 1 && t[W * y + x] > 2) {
                          w[M](z[8], x * 32 + 4, y * 32 + 4);
                      } else if (i == 2 && t[W * y + x] > 2) {
                          w[M](z[t[W * y + x]], x * 32, y * 32);
                      }
                  }
              }
              if (i == 1 && q) {
                  w[M](z[7], u.x * 32 + 4, u.y * 32 + 4);
              } else if (i == 2 && q) {
                  w[M](z[4], u.x * 32, u.y * 32);
              }
          }
          w.font = 'bold 14px sans-serif';
          w[S] = 'rgba(255,255,255,0.4)';
          w.textAlign = 'center';
          if (!q) {
              for(i = 1; i < E[N] - 5; i++) {
                w[F](E[i], C, i * 19 + 106);
              }
              w[F](E[9], C, 376);
          } else {
              if (f) {
                  w[F](E[0], C, 19);
              }
              w[F](E[11] + (v + 1) + E[10] + E[12] + m + E[10] + E[13] + h, C, 376);
          }
      }

      function init() {
          var a = U.getElementById('b');
          if (!!a[X]) {
              w = a[X]('2d');
              z = Array(P[N]);
              var r = Array(256);
              for (var i = 0; i < z[N]; i++) {
                  g(I, P[i][3], r);
                  var e = U.createElement('canvas');
                  e.width = 32;
                  e.height = 32;
                  var s = e[X]('2d');
                  for (var x = 0; x < 16; x++) {
                      for (var y = 0; y < 16; y++) {
                          s[S] = P[i][r[16 * y + x]];
                          s.fillRect(x * 2, y * 2, 2, 2);
                      }
                  }
                  z[i] = e;
              }
              t = Array(W * H);
              v = 0;
              u = { x: 0, y: 0 };
              q = !1;
              b = !1;
              l();
              p();
              O[A]('keydown', function(e) {
                  e.preventDefault();
                  if (!b) {
                      b = !0;
                      if (q) {
                          var d = { x: 0, y: 0 };
                          switch (e.keyCode) {
                              case 38:
                                  d.y = -1;
                                  break;
                              case 40:
                                  d.y = 1;
                                  break;
                              case 37:
                                  d.x = -1;
                                  break;
                              case 39:
                                  d.x = 1;
                                  break;
                              case 33:
                                  v++;
                                  l();
                                  break;
                              case 34:
                                  v--;
                                  l();
                                  break;
                              case 8:
                                  l();
                                  break;
                              case 13:
                                  if (f) {
                                      v++;
                                      l();
                                  }
                                  break;
                              default:
                                  return;
                          }
                          if ((d.x != 0 || d.y != 0) && !f) {
                              var s = W * (u.y + d.y) + u.x + d.x;
                              var n = W * (u.y + d.y * 2) + u.x + d.x * 2;
                              if (t[s] == 1 || t[s] == 2) {
                                  u.x += d.x;
                                  u.y += d.y;
                                  m++;
                              } else if ((t[s] == 5 || t[s] == 6) && (t[n] == 1 || t[n] == 2)) {
                                  t[s] = t[s] == 5 ? 1 : 2;
                                  t[n] = t[n] == 1 ? 5 : 6;
                                  u.x += d.x;
                                  u.y += d.y;
                                  m++;
                                  h++;
                              }
                              n = !0;
                              for (var i = 0; i < t[N]; i++) {
                                  if (t[i] == 5) {
                                      n = !1;
                                  }
                              }
                              f = n;
                          }
                      } else {
                          q = !0;
                      }
                      p();
                  }
              }, !1);
              O[A]('keyup', function() {
                  b = !1;
              }, !1);
          }
      }
    </script>
    <style type="text/css">
      body {
        background-color: #000;
        color: #fff;
        margin: 0
      }
      #w {
        display: table;
        position: absolute;
        height: 100%;
        width: 100%
      }
      #c {
        display: table-cell;
        vertical-align: middle
      }
      #b {
        display: block;
        height: 384px;
        margin: 0 auto;
        width: 448px
      }
    </style>
  </head>
  <body onload="init();">
    <div id="w">
      <div id="c">
        <canvas id="b" width="448" height="384"></canvas>
      </div>
    </div>
  </body>
</html>
